[tox]
envlist = py{39,310,311,312,313}, docs, lint, mypy
isolated_build = true

[testenv]
deps =
    pytest>=8.4.2
    pytest-cov>=7.0.0
    pytest-xdist>=3.8.0
    peakrdl>=1.4.0
commands =
    pytest {posargs}

[testenv:docs]
deps =
    sphinx>=4.0.0
    sphinx-book-theme>=0.3.0
commands =
    sphinx-build -W -b html docs docs/_build/html
    sphinx-build -W -b linkcheck docs docs/_build/linkcheck

[testenv:docs-rtd]
# Environment that mimics Read the Docs build
deps =
    sphinx>=4.0.0
    sphinx-book-theme>=0.3.0
    .
commands =
    sphinx-build -b html docs docs/_build/html
    sphinx-build -b epub docs docs/_build/epub
    sphinx-build -b pdf docs docs/_build/pdf

[testenv:docs-serve]
deps =
    sphinx>=4.0.0
    sphinx-book-theme>=0.3.0
    sphinx-autobuild
commands =
    sphinx-autobuild docs docs/_build/html --port 8000

[testenv:lint]
deps =
    ruff>=0.3.0
commands =
    ruff check src tests
    ruff format --check src tests

[testenv:lint-fix]
deps =
    ruff>=0.3.0
commands =
    ruff check --fix src tests
    ruff format src tests

[testenv:mypy]
deps =
    mypy>=1.8.0
    types-setuptools
commands =
    mypy src

[testenv:coverage]
deps =
    pytest>=8.4.2
    pytest-cov>=7.0.0
    pytest-xdist>=3.8.0
    peakrdl>=1.4.0
commands =
    pytest --cov=peakrdl_rust --cov-report=html --cov-report=xml --cov-report=term-missing {posargs}

[testenv:dev]
deps =
    pytest>=8.4.2
    pytest-cov>=7.0.0
    pytest-xdist>=3.8.0
    peakrdl>=1.4.0
    ruff>=0.3.0
    mypy>=1.8.0
    sphinx>=4.0.0
    sphinx-book-theme>=0.3.0
    sphinx-autobuild
commands =
    python -c "print('Development environment ready!')"
    python -c "print('Available commands:')"
    python -c "print('  pytest                    # Run tests')"
    python -c "print('  ruff check src tests      # Lint code')"
    python -c "print('  mypy src                  # Type check')"
    python -c "print('  sphinx-build -b html docs docs/_build/html  # Build docs')"
    python -c "print('  tox -e docs-rtd           # Build docs like Read the Docs')"

[testenv:clean]
deps =
commands =
    python -c "import shutil; shutil.rmtree('docs/_build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.coverage', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.pytest_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.mypy_cache', ignore_errors=True)"
    python -c "print('Cleaned build artifacts')"

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311, docs, lint, mypy
    3.12: py312
    3.13: py313
